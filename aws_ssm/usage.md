# AWS SSM Parameter Module

Creates one or more AWS SSM Parameter Store parameters from a single module input.

## Features

- Create multiple parameters in one module call
- Supports `String`, `StringList`, and `SecureString`
- Optional KMS key for `SecureString`
- Supports overwrite and tier controls
- Supports `data_type`, `allowed_pattern`, and `policies`
- Supports common tags and per-parameter tags
- Includes validations for safer input

## Basic Usage

```hcl
module "ssm_parameters" {
  source = "./aws_ssm"

  plain_parameters = [
    {
      name  = "/app/dev/api_url"
      value = "https://api.dev.example.com"
    }
  ]
}
```

## Advanced Usage

```hcl
module "ssm_parameters" {
  source = "./aws_ssm"

  tags = {
    Environment = "prod"
    ManagedBy   = "terraform"
  }

  plain_parameters = [
    {
      name        = "/app/prod/db_host"
      value       = "db.prod.internal"
      description = "Database host endpoint"
      type        = "String"
      overwrite   = true
      tier        = "Standard"
      tags = {
        Service = "backend"
      }
    },
    {
      name            = "/app/prod/ami_id"
      value           = "ami-0123456789abcdef0"
      type            = "String"
      data_type       = "aws:ec2:image"
      allowed_pattern = "^ami-[a-z0-9]+$"
      overwrite       = true
    },
    {
      name      = "/app/prod/allowed_ips"
      value     = "10.0.0.1,10.0.0.2"
      type      = "StringList"
      overwrite = true
    }
  ]

  secure_parameters = [
    {
      name        = "/app/prod/db_password"
      value       = "replace-me-securely"
      description = "Database password"
      key_id      = "arn:aws:kms:us-east-1:123456789012:key/11111111-2222-3333-4444-555555555555"
      overwrite   = true
      tier        = "Advanced"
      policies    = jsonencode([
        {
          Type    = "Expiration"
          Version = "1.0"
          Attributes = {
            Timestamp = "2028-01-01T00:00:00Z"
          }
        }
      ])
    }
  ]
}
```

## Inputs

| Variable | Type | Default | Required | Description |
|----------|------|---------|----------|-------------|
| `tags` | `map(string)` | `{}` | No | Common tags applied to all parameters |
| `plain_parameters` | `list(object)` | `[]` | No | Preferred list for `String` / `StringList` parameters |
| `secure_parameters` | `list(object)` | `[]` | No | Preferred list for `SecureString` parameters |
| `parameters` | `list(object)` | `[]` | No | Backward-compatible generic list (deprecated) |

### `plain_parameters` object fields

| Field | Type | Default | Required | Description |
|------|------|---------|----------|-------------|
| `name` | `string` | - | Yes | Parameter name (unique, valid SSM name chars) |
| `value` | `string` | - | Yes | Parameter value |
| `description` | `string` | `null` | No | Optional parameter description |
| `type` | `string` | `"String"` | No | `String` or `StringList` |
| `overwrite` | `bool` | `false` | No | Overwrite existing parameter with same name |
| `tier` | `string` | `"Standard"` | No | `Standard`, `Advanced`, or `Intelligent-Tiering` |
| `data_type` | `string` | `"text"` | No | `text`, `aws:ec2:image`, or `aws:ssm:integration` (String only) |
| `allowed_pattern` | `string` | `null` | No | Regex constraint for parameter value |
| `policies` | `string` | `null` | No | JSON policy string for parameter policies |
| `tags` | `map(string)` | `{}` | No | Per-parameter tags (merged with module-level tags) |

### `secure_parameters` object fields

| Field | Type | Default | Required | Description |
|------|------|---------|----------|-------------|
| `name` | `string` | - | Yes | Parameter name (unique, valid SSM name chars) |
| `value` | `string` | - | Yes | Secure parameter value |
| `description` | `string` | `null` | No | Optional parameter description |
| `key_id` | `string` | `null` | No | KMS key ARN/ID for encryption |
| `overwrite` | `bool` | `false` | No | Overwrite existing parameter |
| `tier` | `string` | `"Standard"` | No | `Standard`, `Advanced`, or `Intelligent-Tiering` |
| `allowed_pattern` | `string` | `null` | No | Regex constraint for parameter value |
| `policies` | `string` | `null` | No | JSON policy string for parameter policies |
| `tags` | `map(string)` | `{}` | No | Per-parameter tags (merged with module-level tags) |

## Outputs

| Output | Description |
|--------|-------------|
| `parameter_arns` | Map of parameter ARNs keyed by parameter name |
| `parameter_names` | List of created parameter names |
| `parameter_versions` | Map of versions keyed by parameter name |

## Suggested Improvements

1. Add optional outputs for `version -> name` reverse index if your pipelines need direct version lookups.
2. Add optional integration for bulk import from `tfvars` files generated by CI.
